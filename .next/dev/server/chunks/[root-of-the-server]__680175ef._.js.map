{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HORIZON/OneDrive/Desktop/chat-gpt/my-app/app/api/chat/route.ts"],"sourcesContent":["import { GoogleGenerativeAI } from \"@google/generative-ai\";\nimport { NextResponse } from \"next/server\";\n\nexport async function POST(req: Request) {\n  try {\n    // Check if it's multipart form data or JSON\n    const contentType = req.headers.get(\"content-type\") || \"\";\n    \n    let message = \"\";\n    let file: File | null = null;\n    \n    if (contentType.includes(\"multipart/form-data\")) {\n      // Handle file upload\n      const formData = await req.formData();\n      message = formData.get(\"message\") as string || \"\";\n      file = formData.get(\"file\") as File || null;\n      console.log(\"üìé Multipart request received\");\n    } else {\n      // Handle text-only JSON\n      const body = await req.json();\n      message = body.messages?.[body.messages.length - 1]?.content || \"\";\n      console.log(\"üí¨ JSON request received\");\n    }\n    \n    const apiKey = process.env.GEMINI_API_KEY;\n    \n    if (!apiKey) {\n      return NextResponse.json(\n        { error: \"Gemini API key is not configured\" },\n        { status: 500 }\n      );\n    }\n\n    const genAI = new GoogleGenerativeAI(apiKey);\n    const model = genAI.getGenerativeModel({ model: \"gemini-2.5-flash\" });\n    \n    let response;\n    \n    // Handle file upload\n    if (file) {\n      console.log(\"üìé Processing file:\", file.name, file.type, file.size);\n      \n      // Convert file to base64\n      const bytes = await file.arrayBuffer();\n      const buffer = Buffer.from(bytes);\n      const base64Data = buffer.toString('base64');\n      \n      // Determine MIME type\n      let mimeType = file.type;\n      if (!mimeType || mimeType === 'application/octet-stream') {\n        if (file.name.endsWith('.pdf')) mimeType = 'application/pdf';\n        else if (file.name.endsWith('.jpg') || file.name.endsWith('.jpeg')) mimeType = 'image/jpeg';\n        else if (file.name.endsWith('.png')) mimeType = 'image/png';\n        else if (file.name.endsWith('.txt')) mimeType = 'text/plain';\n        else if (file.name.endsWith('.doc')) mimeType = 'application/msword';\n        else if (file.name.endsWith('.docx')) mimeType = 'application/vnd.openxmlformats-officedocument.wordprocessingml.document';\n      }\n      \n      // Create parts array\n      const parts = [];\n      \n      // Add text prompt\n      if (message) {\n        parts.push({ text: message });\n      } else {\n        parts.push({ text: \"Please analyze this file and tell me what it contains.\" });\n      }\n      \n      // Add file data\n      if (mimeType.startsWith('image/')) {\n        parts.push({\n          inlineData: {\n            mimeType: mimeType,\n            data: base64Data\n          }\n        });\n      } else if (mimeType === 'application/pdf') {\n        parts.push({\n          inlineData: {\n            mimeType: 'application/pdf',\n            data: base64Data\n          }\n        });\n      } else if (mimeType === 'text/plain') {\n        const textContent = buffer.toString('utf-8');\n        parts.push({ text: `\\n\\nFile content (${file.name}):\\n${textContent}` });\n      } else {\n        parts.push({ text: `\\n\\nFile attached: ${file.name} (${mimeType})` });\n      }\n      \n      const result = await model.generateContent({\n        contents: [{ role: \"user\", parts }]\n      });\n      \n      response = await result.response;\n      console.log(\"‚úÖ Gemini response with file received\");\n      \n    } else {\n      // Text-only\n      console.log(\"üí¨ Sending text to Gemini:\", message.substring(0, 50) + \"...\");\n      const result = await model.generateContent(message);\n      response = await result.response;\n      console.log(\"‚úÖ Gemini text response received\");\n    }\n    \n    const text = response.text();\n    \n    return NextResponse.json({ \n      response: text,\n      fileProcessed: !!file \n    });\n    \n  } catch (error: any) {\n    console.error(\"‚ùå Gemini API Error:\", error);\n    \n    // Check for specific Gemini errors\n    let errorMessage = \"Failed to generate response\";\n    if (error.message?.includes(\"API key\")) {\n      errorMessage = \"Invalid API key. Please check your Gemini API key.\";\n    } else if (error.message?.includes(\"quota\")) {\n      errorMessage = \"API quota exceeded. Please try again later.\";\n    } else if (error.message?.includes(\"model\")) {\n      errorMessage = \"Model not available. Please try again.\";\n    }\n    \n    return NextResponse.json(\n      { \n        error: errorMessage,\n        details: error?.message || \"Unknown error\"\n      },\n      { status: 500 }\n    );\n  }\n}\n\nexport async function GET() {\n  return NextResponse.json({ error: \"Method not allowed\" }, { status: 405 });\n}"],"names":[],"mappings":"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"}}]
}